import{_,o as r,c as v,a as c,D as Z,E as ee,f as S,G as z,H as E,t as D,h as I,u as e,B as P,s as C,n as W,F as g,k as b,p as w,e as L,J as te,w as p,d as y,b as u,r as O,K as ae,L as oe,M as le,i as H,q as A,N as X,I as ne,g as se,O as re,l as ie,P as de,y as ce,z as ue,Q as me,S as pe,j as ve}from"./index-C6X_CLJF.js";import{I as fe}from"./IconCategory-3ds1tKiu.js";import{I as M,B as x}from"./BaseSelectMenu-iNajMUdy.js";import{I as ye}from"./IconPrice-Z-yQrI7w.js";import{I as ge}from"./IconLocation-146jPYWW.js";import{B as he}from"./BaseBadge-skvWm0U9.js";import{B as Ie}from"./BaseButton-RBn3mrKf.js";import{u as _e,r as q,B as j,a as $e,b as be}from"./BaseInput-XmIfhhwm.js";import{I as ke}from"./IconDelete-XvCRJHXM.js";import{B as N}from"./BaseFormGroup-Pt3KonYi.js";const Ve={name:"TablerPhoto"},Se={xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24"},De=c("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[c("path",{d:"M15 8h.01M3 6a3 3 0 0 1 3-3h12a3 3 0 0 1 3 3v12a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V6z"}),c("path",{d:"m3 16l5-5c.928-.893 2.072-.893 3 0l5 5"}),c("path",{d:"m14 14l1-1c.928-.893 2.072-.893 3 0l3 3"})],-1),Be=[De];function Ce(t,o,n,a,i,m){return r(),v("svg",Se,Be)}const we=_(Ve,[["render",Ce]]),Le=async function(t){var n;const o=(await Z({url:"https://media.rentinhand.ru/upload/public",method:"post",data:t,withCredentials:!1})).data;return ee((n=o==null?void 0:o.array)==null?void 0:n[0])},Pe=t=>(w("data-v-259de1d7"),t=t(),L(),t),Ne=Pe(()=>c("hr",{class:"category-delim"},null,-1)),Ae={__name:"SelectCategoryItem",props:{category:{type:Object,required:!0},hasBorder:{type:Boolean,default:!0},level:{type:Number,default:0},activeId:{type:[Number,String],default:null},isParentActive:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},emits:["click"],setup(t){const o=t,n=S(()=>z.isArray(o.category.children)&&o.category.children.length>0),a=S(()=>o.isParentActive||o.activeId===o.category.id),i=S(()=>`${o.level*30}px`);return(m,s)=>{const l=E("SelectCategoryItem",!0);return r(),v(g,null,[c("div",{class:C(["category-item",{loading:t.isLoading}]),style:W({marginLeft:i.value}),onClick:s[0]||(s[0]=d=>m.$emit("click",t.category))},[c("h3",null,D(t.category.title),1),a.value?(r(),I(e(M),{key:0,class:"icon-check"})):P("",!0)],6),Ne,n.value?(r(!0),v(g,{key:0},b(t.category.children,d=>(r(),I(l,{key:d.id,category:d,level:t.level+1,"active-id":t.activeId,"is-parent-active":a.value,onClick:s[1]||(s[1]=h=>m.$emit("click",h))},null,8,["category","level","active-id","is-parent-active"]))),128)):P("",!0)],64)}}},K=_(Ae,[["__scopeId","data-v-259de1d7"]]),Ee=t=>(w("data-v-95c18537"),t=t(),L(),t),Oe={class:"select-category-content"},Me={key:1,class:"no-categories"},xe=Ee(()=>c("span",{class:"no-categories-text"}," Нет добавленных категорий ",-1)),Re={__name:"SelectCategory",props:{isError:{type:Boolean,default:!1},modelValue:{type:Object,default:null}},emits:["update:modelValue"],setup(t){const o=te(),n=function(){o.hasUnloadedOptions&&o.fetchMany({perPage:999,page:1,search:""})};return(a,i)=>{const m=E("RouterLink");return r(),I(e(x),{"modal-title":"Категория инвентаря","is-error":t.isError,onOpen:n},{label:p(()=>[y(" Категория ")]),"modal-content":p(()=>[c("div",Oe,[!e(o).isManyLoading&&e(o).listData.length>0?(r(!0),v(g,{key:0},b(e(o).listData,(s,l)=>{var d;return r(),I(K,{key:s.id,category:s,"has-border":l!==e(o).listData.length-1,"active-id":(d=t.modelValue)==null?void 0:d.id,onClick:i[0]||(i[0]=h=>a.$emit("update:modelValue",h))},null,8,["category","has-border","active-id"])}),128)):!e(o).isManyLoading&&e(o).listData.length===0?(r(),v("div",Me,[u(e(fe),{class:"no-categories-icon"}),xe,u(m,{class:"add-category",to:{name:"AddCategory",query:{backRouteName:"AddInventory"}}},{default:p(()=>[y(" Добавить категорию ")]),_:1})])):(r(),v(g,{key:2},b(8,s=>u(K,{key:s,category:{},"has-border":s!==8,"is-loading":""},null,8,["has-border"])),64))])]),"error-text":p(()=>[O(a.$slots,"error-text",{},void 0,!0)]),_:3},8,["is-error"])}}},Te=_(Re,[["__scopeId","data-v-95c18537"]]),Ue=t=>(w("data-v-9b48fbdf"),t=t(),L(),t),Fe=Ue(()=>c("hr",{class:"inventory-price-delim"},null,-1)),qe={__name:"SelectInventoryPriceItem",props:{inventoryPrice:{type:Object,required:!0},hasBorder:{type:Boolean,default:!0},level:{type:Number,default:0},isActive:{type:Boolean,defulat:!1},isLoading:{type:Boolean,default:!1}},emits:["click"],setup(t){return(o,n)=>(r(),v(g,null,[c("div",{class:C(["inventory-price-item",{loading:t.isLoading}]),onClick:n[0]||(n[0]=a=>o.$emit("click",t.inventoryPrice))},[c("h3",null,D(t.inventoryPrice.title),1),t.isActive?(r(),I(e(M),{key:0,class:"icon-check"})):P("",!0)],2),Fe],64))}},G=_(qe,[["__scopeId","data-v-9b48fbdf"]]),je=t=>(w("data-v-878674f8"),t=t(),L(),t),ze={class:"select-inventory-price-content"},He={key:1,class:"no-inventory-prices"},Ke=je(()=>c("span",{class:"no-inventory-prices-text"}," Нет добавленных тарифов ",-1)),Ge={__name:"SelectInventoryPrice",props:{isError:{type:Boolean,default:!1},modelValue:{type:Object,default:null}},emits:["update:modelValue"],setup(t){const o=ae(),n=function(){o.hasUnloadedOptions&&o.fetchMany({perPage:999,page:1,search:""})};return(a,i)=>{const m=E("RouterLink");return r(),I(e(x),{"modal-title":"Тарифы","is-error":t.isError,onOpen:n},{label:p(()=>[y(" Тариф * ")]),"modal-content":p(()=>[c("div",ze,[!e(o).isManyLoading&&e(o).listData.length>0?(r(!0),v(g,{key:0},b(e(o).listData,(s,l)=>{var d;return r(),I(G,{key:s.id,"inventory-price":s,"has-border":l!==e(o).listData.length-1,"is-active":s.id===((d=t.modelValue)==null?void 0:d.id),onClick:i[0]||(i[0]=h=>a.$emit("update:modelValue",h))},null,8,["inventory-price","has-border","is-active"])}),128)):!e(o).isManyLoading&&e(o).listData.length===0?(r(),v("div",He,[u(e(ye),{class:"no-inventory-prices-icon"}),Ke,u(m,{class:"add-inventory-price",to:{name:"AddInventoryPrice",query:{backRouteName:"AddInventory"}}},{default:p(()=>[y(" Добавить тариф ")]),_:1})])):(r(),v(g,{key:2},b(8,s=>u(G,{key:s,"inventory-price":{},"has-border":s!==8,"is-loading":""},null,8,["has-border"])),64))])]),"error-text":p(()=>[O(a.$slots,"error-text",{},void 0,!0)]),_:3},8,["is-error"])}}},Je=_(Ge,[["__scopeId","data-v-878674f8"]]),Qe=t=>(w("data-v-5bcb63d4"),t=t(),L(),t),Ye=Qe(()=>c("hr",{class:"point-price-delim"},null,-1)),We={__name:"SelectPointItem",props:{point:{type:Object,required:!0},hasBorder:{type:Boolean,default:!0},level:{type:Number,default:0},isActive:{type:Boolean,defulat:!1},isLoading:{type:Boolean,default:!1}},emits:["click"],setup(t){return(o,n)=>(r(),v(g,null,[c("div",{class:C(["point-item",{loading:t.isLoading}]),onClick:n[0]||(n[0]=a=>o.$emit("click",t.point))},[c("h3",null,D(t.point.title),1),t.isActive?(r(),I(e(M),{key:0,class:"icon-check"})):P("",!0)],2),Ye],64))}},J=_(We,[["__scopeId","data-v-5bcb63d4"]]),Xe=t=>(w("data-v-d09940c2"),t=t(),L(),t),Ze={class:"select-point-content"},et={key:1,class:"no-points"},tt=Xe(()=>c("span",{class:"no-points-text"}," Нет добавленных точек проката ",-1)),at={__name:"SelectPoint",props:{isError:{type:Boolean,default:!1},modelValue:{type:Object,default:null}},emits:["update:modelValue"],setup(t){const o=oe(),n=function(){o.hasUnloadedOptions&&o.fetchMany({perPage:999,page:1,search:""})};return(a,i)=>{const m=E("RouterLink");return r(),I(e(x),{"modal-title":"Пункты проката","is-error":t.isError,onOpen:n},{label:p(()=>[y(" Пункт проката ")]),"modal-content":p(()=>[c("div",Ze,[!e(o).isManyLoading&&e(o).listData.length>0?(r(!0),v(g,{key:0},b(e(o).listData,(s,l)=>{var d;return r(),I(J,{key:s.id,point:s,"has-border":l!==e(o).listData.length-1,"is-active":s.id===((d=t.modelValue)==null?void 0:d.id),onClick:i[0]||(i[0]=h=>a.$emit("update:modelValue",h))},null,8,["point","has-border","is-active"])}),128)):!e(o).isManyLoading&&e(o).listData.length===0?(r(),v("div",et,[u(e(ge),{class:"no-points-icon"}),tt,u(m,{class:"add-point",to:{name:"AddPoint",query:{backRouteName:"AddInventory"}}},{default:p(()=>[y(" Добавить точку проката ")]),_:1})])):(r(),v(g,{key:2},b(8,s=>u(J,{key:s,point:{},"has-border":s!==8,"is-loading":""},null,8,["has-border"])),64))])]),"error-text":p(()=>[O(a.$slots,"error-text",{},void 0,!0)]),_:3},8,["is-error"])}}},ot=_(at,[["__scopeId","data-v-d09940c2"]]),lt={key:0,class:"select-state-delim"},nt={__name:"SelectInventoryStateItem",props:{state:{type:Object,required:!0},description:{type:String,default:""},hasBorder:{type:Boolean,default:!0},isActive:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},setup(t){return(o,n)=>(r(),v(g,null,[c("div",{class:"select-state-badge-wrapper",onClick:n[0]||(n[0]=a=>o.$emit("click"))},[u(e(he),{class:C(["select-state-badge",{loading:t.isLoading}]),color:t.state.color,size:"md","padding-x":"8px"},{default:p(()=>[y(D(t.state.title),1)]),_:1},8,["class","color"])]),c("div",{class:C(["select-state-description-wrapper",{mr:t.isActive}]),onClick:n[1]||(n[1]=a=>o.$emit("click"))},[c("span",{class:C(["select-state-description",{loading:t.isLoading}])},D(t.description),3),t.isActive?(r(),I(e(M),{key:0,class:"select-state-check"})):P("",!0)],2),t.hasBorder?(r(),v("hr",lt)):P("",!0)],64))}},Q=_(nt,[["__scopeId","data-v-dd5330e8"]]),Y={FREE:"Инвентарь доступен для аренды",BROKEN:"Инвентарь недоступен для аренды",RENT:"Инвентарь сейчас находится в аренде",BOOKED:"На инвентарь имеются аренды в будущем времени",default:"Пользовательский статус инвентаря"},st={class:"select-state-content"},rt={__name:"SelectInventoryState",props:{isError:{type:Boolean,default:!1},modelValue:{type:Object,default:null}},emits:["update:modelValue"],setup(t){const o=le(),n=function(){o.hasUnloadedOptions&&o.fetchMany({perPage:999,page:1,search:""})};return(a,i)=>(r(),I(e(x),{"modal-title":"Статус инвентаря","is-error":t.isError,onOpen:n},{label:p(()=>[y(" Статус * ")]),"modal-content":p(()=>[c("div",st,[e(o).isManyLoading?(r(),v(g,{key:1},b(4,m=>u(Q,{key:m,state:{},"has-border":m!==4,"is-loading":""},null,8,["has-border"])),64)):(r(!0),v(g,{key:0},b(e(o).listData,(m,s)=>{var l;return r(),I(Q,{key:m.id,state:m,description:e(Y)[m.stateConst]??e(Y).default,"has-border":s!==e(o).listData.length-1,"is-active":m.id===((l=t.modelValue)==null?void 0:l.id),onClick:d=>a.$emit("update:modelValue",m)},null,8,["state","description","has-border","is-active","onClick"])}),128))])]),"error-text":p(()=>[O(a.$slots,"error-text",{},void 0,!0)]),_:3},8,["is-error"]))}},it=_(rt,[["__scopeId","data-v-f995448b"]]),dt=t=>(w("data-v-b04c8928"),t=t(),L(),t),ct={class:"image-select-wrapper"},ut={class:"image-selected-img-wrapper"},mt={class:"image-selected-actions"},pt=dt(()=>c("label",{class:"label"},"Добавить изображение",-1)),vt={__name:"BaseImageSelect",props:{modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(t,{emit:o}){const i=H(t,"modelValue",o),m=A(null);let s=0;const l=[{title:"Фото или другой медиафайл",id:4},{title:"Аватар, обложка",id:70}],d=function(){m.value.click()},h=function(){return i.value.some($=>$.dictId===70)},R=async function($){const k=new FormData;k.append("file",$.target.files[0]);const f=X({id:++s,isLoading:!0,src:null,resourceId:null,dictId:null,orderId:0});f.dictId=h()?4:70,z.isArray(i.value)?i.value.push(f):i.value=[f];const B=await Le(k);f.id=B.id,f.resourceId=B.resourceId,f.src=B.src,f.isLoading=!1},T=async function($){if(Number($.dictId)===70){const k=i.value.find(f=>f.dictId===70&&f.id!==$.id);k.dictId=4}},U=function($){i.value=i.value.filter(k=>k.id!==$.id)};return($,k)=>(r(),v("div",ct,[(r(!0),v(g,null,b(e(i),f=>(r(),v("div",{class:C(["image-selected",{loading:f.isLoading}]),key:f.id},[c("div",ut,[c("div",{style:W({backgroundImage:"url(https://media.rentinhand.ru/"+f.src+")"}),class:"image-selected-img"},null,4)]),u(e(_t),{class:"image-selected-type",options:l,modelValue:f.dictId,"onUpdate:modelValue":B=>f.dictId=B,onSelect:B=>T(f),disabled:f.isLoading},null,8,["modelValue","onUpdate:modelValue","onSelect","disabled"]),c("div",mt,[u(e(ke),{class:"image-selected-delete",onClick:B=>U(f)},null,8,["onClick"])])],2))),128)),c("div",{class:"image-select",onClick:d},[u(e(we),{class:"icon"}),pt]),c("input",{type:"file",ref_key:"fileDialog",ref:m,accept:"image/*",onChange:R},null,544)]))}},ft=_(vt,[["__scopeId","data-v-b04c8928"]]),yt={class:"base-select-wrapper"},gt=["value","disabled"],ht=["value"],It={__name:"BaseSelect",props:{options:{type:Array,default:()=>[]},label:{type:String,default:"title"},modelValue:{type:null,default:null},reduce:{type:Function,default:Number},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(t,{emit:o}){const n=t,a=o,i=H(n,"modelValue",a),m=s=>{const l=n.reduce(s.target.value);a("update:modelValue",l),a("select",l)};return(s,l)=>(r(),v("div",yt,[c("select",{value:e(i),disabled:t.disabled,class:"base-select",onChange:m},[(r(!0),v(g,null,b(t.options,(d,h)=>(r(),v("option",{key:d.id??d.key??h,value:d.id??d.value},D((d==null?void 0:d[t.label])??d),9,ht))),128))],40,gt),u(e(ne),{class:"select-icon"})]))}},_t=_(It,[["__scopeId","data-v-3665e6c6"]]),$t={class:"wrapper"},bt=["placeholder"],kt={__name:"BaseTextarea",props:{placeholder:{type:String,default:""},modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(t,{emit:o}){const i=H(t,"modelValue",o);return(m,s)=>(r(),v("div",$t,[se(c("textarea",{class:"input",placeholder:t.placeholder,"onUpdate:modelValue":s[0]||(s[0]=l=>ie(i)?i.value=l:null)},null,8,bt),[[re,e(i)]])]))}},Vt=_(kt,[["__scopeId","data-v-ee21efb9"]]),St={title:"",article:"",inventoryNumber:"",description:"",state:null,category:null,price:null,point:null,media:[]},Dt=de("inventoryForm",()=>{const t=ce(),o=ue();let n=X(z.clone(St));const a=A("pending"),i=A(null),m=A(!1),l=_e({formData:{title:{required:q},state:{required:q},price:{required:q}}},{formData:n}),d=S(()=>!l.value.formData.title.$error),h=S(()=>!l.value.formData.price.$error),R=S(()=>!l.value.formData.state.$error),T=S(()=>l.value.formData.title.$errors),U=S(()=>l.value.formData.price.$errors),$=S(()=>l.value.formData.state.$errors),k=function(){n.title="",n.article="",n.inventoryNumber="",n.description="",n.state=null,n.category=null,n.price=null,n.point=null,n.media=[],a.value="pending",i.value=null,l.value.$reset()};return{save:async function(){if(!await l.value.$validate()){m.value=!0;return}a.value="loading",i.value?await t.editOne(i.value,{id:i.value,...n}):await t.addOne(n),a.value="success",setTimeout(()=>{a.value="pending",k(),o.push({name:"Inventories"})},1500)},handleTitleInput:function(){l.value.formData.title.$touch()},formData:n,state:a,isNotificationShown:m,v$:l,isTitleValid:d,isPriceValid:h,isStateValid:R,titleErrors:T,priceErrors:U,stateErrors:$,fillFormData:async function(F){a.value="loading";const V=await t.getOne(F);n.title=V.title,n.article=V.article,n.inventoryNumber=V.inventoryNumber,n.description=V.description,n.state=V.state,n.category=V.category,n.price=V.price,n.point=V.point,n.media=V.media,i.value=F,a.value="pending"},$reset:k}}),Bt={class:"wrapper"},Ct={__name:"InventoryAddPage",props:{id:{type:[String,Number],default:null}},setup(t){const o=t,n=me(),a=Dt(),i=pe();return ve(()=>{i.query.noReset||(a.$reset(),o.id&&a.fillFormData(o.id))}),(m,s)=>(r(),v(g,null,[c("div",Bt,[u(e(N),{"is-error":!e(a).isTitleValid},{label:p(()=>[y(" Название инвентаря * ")]),content:p(()=>[u(e(j),{placeholder:"Введите название","is-error":!e(a).isTitleValid,modelValue:e(a).formData.title,"onUpdate:modelValue":s[0]||(s[0]=l=>e(a).formData.title=l),onInput:e(a).handleTitleInput},null,8,["is-error","modelValue","onInput"])]),"error-text":p(()=>{var l,d;return[y(D(e(n).validationMessages[(d=(l=e(a).titleErrors)==null?void 0:l.at(0))==null?void 0:d.$validator]),1)]}),_:1},8,["is-error"]),u(e(N),null,{label:p(()=>[y(" Артикул ")]),content:p(()=>[u(e(j),{placeholder:"Введите артикул",modelValue:e(a).formData.article,"onUpdate:modelValue":s[1]||(s[1]=l=>e(a).formData.article=l)},null,8,["modelValue"])]),_:1}),u(e(N),null,{label:p(()=>[y(" Инвентарный номер ")]),content:p(()=>[u(e(j),{placeholder:"Введите номер",modelValue:e(a).formData.inventoryNumber,"onUpdate:modelValue":s[2]||(s[2]=l=>e(a).formData.inventoryNumber=l)},null,8,["modelValue"])]),_:1}),u(e(N),null,{label:p(()=>[y(" Описание ")]),content:p(()=>[u(e(Vt),{placeholder:"Введите описание",modelValue:e(a).formData.description,"onUpdate:modelValue":s[3]||(s[3]=l=>e(a).formData.description=l)},null,8,["modelValue"])]),_:1}),u(e(it),{modelValue:e(a).formData.state,"onUpdate:modelValue":s[4]||(s[4]=l=>e(a).formData.state=l),"is-error":!e(a).isStateValid},{"error-text":p(()=>{var l,d;return[y(D(e(n).validationMessages[(d=(l=e(a).stateErrors)==null?void 0:l.at(0))==null?void 0:d.$validator]),1)]}),_:1},8,["modelValue","is-error"]),u(e(Te),{modelValue:e(a).formData.category,"onUpdate:modelValue":s[5]||(s[5]=l=>e(a).formData.category=l)},null,8,["modelValue"]),u(e(Je),{modelValue:e(a).formData.price,"onUpdate:modelValue":s[6]||(s[6]=l=>e(a).formData.price=l),"is-error":!e(a).isPriceValid},{"error-text":p(()=>{var l,d;return[y(D(e(n).validationMessages[(d=(l=e(a).priceErrors)==null?void 0:l.at(0))==null?void 0:d.$validator]),1)]}),_:1},8,["modelValue","is-error"]),u(e(ot),{modelValue:e(a).formData.point,"onUpdate:modelValue":s[7]||(s[7]=l=>e(a).formData.point=l)},null,8,["modelValue"]),u(e(ft),{modelValue:e(a).formData.media,"onUpdate:modelValue":s[8]||(s[8]=l=>e(a).formData.media=l)},null,8,["modelValue"]),u(e(Ie),{onClick:e(a).save},{default:p(()=>[y("Сохранить")]),_:1},8,["onClick"])]),u(e($e),{state:e(a).state},null,8,["state"]),u(e(be),{modelValue:e(a).isNotificationShown,"onUpdate:modelValue":s[9]||(s[9]=l=>e(a).isNotificationShown=l),type:"error"},null,8,["modelValue"])],64))}},Ut=_(Ct,[["__scopeId","data-v-d6d6819e"]]);export{Ut as default};
