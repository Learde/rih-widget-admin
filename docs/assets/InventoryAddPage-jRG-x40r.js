import{_ as $,o as s,c as p,a as d,H as Z,J as ee,k as C,K as z,r as M,x as w,e as b,u as e,E as A,n as P,t as W,F as V,j as D,p as N,d as x,L as te,w as m,f as _,b as u,i as T,M as ae,N as oe,O as le,m as H,A as O,P as X,I as ne,l as se,Q as re,y as ie,S as ce,C as de,g as ue,T as me,U as pe,q as ve}from"./index-436tC9rP.js";import{I as fe}from"./IconCategory-p8R_rgdG.js";import{I as R,B as U}from"./BaseSelectMenu-ys1LlDGC.js";import{I as ye}from"./IconPrice-Mj4hHvY8.js";import{I as ge}from"./IconLocation-cjhqrWpE.js";import{B as he}from"./BaseBadge-amr7Dm8G.js";import{B as Ie}from"./BaseButton-lhhRx-Nn.js";import{u as ke,r as q,B as j,a as _e,b as Ve}from"./BaseInput-vHVzaQb9.js";import{I as be}from"./IconDelete-DwjwV3ks.js";import{B as E}from"./BaseFormGroup-stphhqJr.js";const $e={name:"TablerPhoto"},Se={xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24"},De=d("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[d("path",{d:"M15 8h.01M3 6a3 3 0 0 1 3-3h12a3 3 0 0 1 3 3v12a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V6z"}),d("path",{d:"m3 16l5-5c.928-.893 2.072-.893 3 0l5 5"}),d("path",{d:"m14 14l1-1c.928-.893 2.072-.893 3 0l3 3"})],-1),Be=[De];function Ce(t,r,l,a,c,f){return s(),p("svg",Se,Be)}const we=$($e,[["render",Ce]]),Le=async function(t){var l;const r=(await Z({url:"https://media.rentinhand.ru/upload/public",method:"post",data:t,withCredentials:!1})).data;return ee((l=r==null?void 0:r.array)==null?void 0:l[0])},Pe=t=>(N("data-v-259de1d7"),t=t(),x(),t),Ne=Pe(()=>d("hr",{class:"category-delim"},null,-1)),xe={__name:"SelectCategoryItem",props:{category:{type:Object,required:!0},hasBorder:{type:Boolean,default:!0},level:{type:Number,default:0},activeId:{type:[Number,String],default:null},isParentActive:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},emits:["click"],setup(t){const r=t,l=C(()=>z.isArray(r.category.children)&&r.category.children.length>0),a=C(()=>r.isParentActive||r.activeId===r.category.id),c=C(()=>`${r.level*30}px`);return(f,n)=>{const o=M("SelectCategoryItem",!0);return s(),p(V,null,[d("div",{class:P(["category-item",{loading:t.isLoading}]),style:W({marginLeft:c.value}),onClick:n[0]||(n[0]=i=>f.$emit("click",t.category))},[d("h3",null,w(t.category.title),1),a.value?(s(),b(e(R),{key:0,class:"icon-check"})):A("",!0)],6),Ne,l.value?(s(!0),p(V,{key:0},D(t.category.children,i=>(s(),b(o,{key:i.id,category:i,level:t.level+1,"active-id":t.activeId,"is-parent-active":a.value,onClick:n[1]||(n[1]=h=>f.$emit("click",h))},null,8,["category","level","active-id","is-parent-active"]))),128)):A("",!0)],64)}}},K=$(xe,[["__scopeId","data-v-259de1d7"]]),Ae=t=>(N("data-v-e8aa7cee"),t=t(),x(),t),Ee={class:"select-category-content"},Oe={key:1,class:"no-categories"},Me=Ae(()=>d("span",{class:"no-categories-text"}," Нет добавленных категорий ",-1)),Te={__name:"SelectCategory",props:{isError:{type:Boolean,default:!1},modelValue:{type:Object,default:null}},emits:["update:modelValue"],setup(t,{emit:r}){const l=r,a=te(),c=function(){a.hasUnloadedOptions&&a.fetchMany({perPage:999,page:1,search:""})},f=function(n,o){l("update:modelValue",n),o()};return(n,o)=>{var h;const i=M("RouterLink");return s(),b(e(U),{"modal-title":"Категория инвентаря",placeholder:"Не выбрана","is-error":t.isError,value:(h=t.modelValue)==null?void 0:h.title,onOpen:c},{label:m(()=>[_(" Категория ")]),"modal-content":m(({closeModal:I})=>[d("div",Ee,[!e(a).isManyLoading&&e(a).listData.length>0?(s(!0),p(V,{key:0},D(e(a).listData,(v,S)=>{var y;return s(),b(K,{key:v.id,category:v,"has-border":S!==e(a).listData.length-1,"active-id":(y=t.modelValue)==null?void 0:y.id,onClick:k=>f(k,I)},null,8,["category","has-border","active-id","onClick"])}),128)):!e(a).isManyLoading&&e(a).listData.length===0?(s(),p("div",Oe,[u(e(fe),{class:"no-categories-icon"}),Me,u(i,{class:"add-category",to:{name:"AddCategory",query:{backRouteName:"AddInventory"}}},{default:m(()=>[_(" Добавить категорию ")]),_:1})])):(s(),p(V,{key:2},D(8,v=>u(K,{key:v,category:{},"has-border":v!==8,"is-loading":""},null,8,["has-border"])),64))])]),"error-text":m(()=>[T(n.$slots,"error-text",{},void 0,!0)]),_:3},8,["is-error","value"])}}},Re=$(Te,[["__scopeId","data-v-e8aa7cee"]]),Ue=t=>(N("data-v-9b48fbdf"),t=t(),x(),t),Fe=Ue(()=>d("hr",{class:"inventory-price-delim"},null,-1)),qe={__name:"SelectInventoryPriceItem",props:{inventoryPrice:{type:Object,required:!0},hasBorder:{type:Boolean,default:!0},level:{type:Number,default:0},isActive:{type:Boolean,defulat:!1},isLoading:{type:Boolean,default:!1}},emits:["click"],setup(t){return(r,l)=>(s(),p(V,null,[d("div",{class:P(["inventory-price-item",{loading:t.isLoading}]),onClick:l[0]||(l[0]=a=>r.$emit("click",t.inventoryPrice))},[d("h3",null,w(t.inventoryPrice.title),1),t.isActive?(s(),b(e(R),{key:0,class:"icon-check"})):A("",!0)],2),Fe],64))}},G=$(qe,[["__scopeId","data-v-9b48fbdf"]]),je=t=>(N("data-v-35c53ec4"),t=t(),x(),t),ze={class:"select-inventory-price-content"},He={key:1,class:"no-inventory-prices"},Ke=je(()=>d("span",{class:"no-inventory-prices-text"}," Нет добавленных тарифов ",-1)),Ge={__name:"SelectInventoryPrice",props:{isError:{type:Boolean,default:!1},modelValue:{type:Object,default:null}},emits:["update:modelValue"],setup(t,{emit:r}){const l=r,a=ae(),c=function(){a.hasUnloadedOptions&&a.fetchMany({perPage:999,page:1,search:""})},f=function(n,o){l("update:modelValue",n),o()};return(n,o)=>{var h;const i=M("RouterLink");return s(),b(e(U),{"modal-title":"Тарифы","is-error":t.isError,value:(h=t.modelValue)==null?void 0:h.title,onOpen:c},{label:m(()=>[_(" Тариф * ")]),"modal-content":m(({closeModal:I})=>[d("div",ze,[!e(a).isManyLoading&&e(a).listData.length>0?(s(!0),p(V,{key:0},D(e(a).listData,(v,S)=>{var y;return s(),b(G,{key:v.id,"inventory-price":v,"has-border":S!==e(a).listData.length-1,"is-active":v.id===((y=t.modelValue)==null?void 0:y.id),onClick:k=>f(k,I)},null,8,["inventory-price","has-border","is-active","onClick"])}),128)):!e(a).isManyLoading&&e(a).listData.length===0?(s(),p("div",He,[u(e(ye),{class:"no-inventory-prices-icon"}),Ke,u(i,{class:"add-inventory-price",to:{name:"AddInventoryPrice",query:{backRouteName:"AddInventory"}}},{default:m(()=>[_(" Добавить тариф ")]),_:1})])):(s(),p(V,{key:2},D(8,v=>u(G,{key:v,"inventory-price":{},"has-border":v!==8,"is-loading":""},null,8,["has-border"])),64))])]),"error-text":m(()=>[T(n.$slots,"error-text",{},void 0,!0)]),_:3},8,["is-error","value"])}}},Je=$(Ge,[["__scopeId","data-v-35c53ec4"]]),Qe=t=>(N("data-v-5bcb63d4"),t=t(),x(),t),Ye=Qe(()=>d("hr",{class:"point-price-delim"},null,-1)),We={__name:"SelectPointItem",props:{point:{type:Object,required:!0},hasBorder:{type:Boolean,default:!0},level:{type:Number,default:0},isActive:{type:Boolean,defulat:!1},isLoading:{type:Boolean,default:!1}},emits:["click"],setup(t){return(r,l)=>(s(),p(V,null,[d("div",{class:P(["point-item",{loading:t.isLoading}]),onClick:l[0]||(l[0]=a=>r.$emit("click",t.point))},[d("h3",null,w(t.point.title),1),t.isActive?(s(),b(e(R),{key:0,class:"icon-check"})):A("",!0)],2),Ye],64))}},J=$(We,[["__scopeId","data-v-5bcb63d4"]]),Xe=t=>(N("data-v-c2c8c282"),t=t(),x(),t),Ze={class:"select-point-content"},et={key:1,class:"no-points"},tt=Xe(()=>d("span",{class:"no-points-text"}," Нет добавленных точек проката ",-1)),at={__name:"SelectPoint",props:{isError:{type:Boolean,default:!1},modelValue:{type:Object,default:null}},emits:["update:modelValue"],setup(t,{emit:r}){const l=r,a=oe(),c=function(){a.hasUnloadedOptions&&a.fetchMany({perPage:999,page:1,search:""})},f=function(n,o){l("update:modelValue",n),o()};return(n,o)=>{var h;const i=M("RouterLink");return s(),b(e(U),{"modal-title":"Пункты проката","is-error":t.isError,value:(h=t.modelValue)==null?void 0:h.title,onOpen:c},{label:m(()=>[_(" Пункт проката ")]),"modal-content":m(({closeModal:I})=>[d("div",Ze,[!e(a).isManyLoading&&e(a).listData.length>0?(s(!0),p(V,{key:0},D(e(a).listData,(v,S)=>{var y;return s(),b(J,{key:v.id,point:v,"has-border":S!==e(a).listData.length-1,"is-active":v.id===((y=t.modelValue)==null?void 0:y.id),onClick:k=>f(k,I)},null,8,["point","has-border","is-active","onClick"])}),128)):!e(a).isManyLoading&&e(a).listData.length===0?(s(),p("div",et,[u(e(ge),{class:"no-points-icon"}),tt,u(i,{class:"add-point",to:{name:"AddPoint",query:{backRouteName:"AddInventory"}}},{default:m(()=>[_(" Добавить точку проката ")]),_:1})])):(s(),p(V,{key:2},D(8,v=>u(J,{key:v,point:{},"has-border":v!==8,"is-loading":""},null,8,["has-border"])),64))])]),"error-text":m(()=>[T(n.$slots,"error-text",{},void 0,!0)]),_:3},8,["is-error","value"])}}},ot=$(at,[["__scopeId","data-v-c2c8c282"]]),Q={FREE:"Инвентарь доступен для аренды",BROKEN:"Инвентарь недоступен для аренды",RENT:"Инвентарь сейчас находится в аренде",BOOKED:"На инвентарь имеются аренды в будущем времени",default:"Пользовательский статус инвентаря"},lt={key:0,class:"select-state-delim"},nt={__name:"SelectInventoryStateItem",props:{state:{type:Object,required:!0},description:{type:String,default:""},hasBorder:{type:Boolean,default:!0},isActive:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},setup(t){return(r,l)=>(s(),p(V,null,[d("div",{class:"select-state-badge-wrapper",onClick:l[0]||(l[0]=a=>r.$emit("click"))},[u(e(he),{class:P(["select-state-badge",{loading:t.isLoading}]),color:t.state.color,size:"md","padding-x":"8px"},{default:m(()=>[_(w(t.state.title),1)]),_:1},8,["class","color"])]),d("div",{class:P(["select-state-description-wrapper",{mr:t.isActive}]),onClick:l[1]||(l[1]=a=>r.$emit("click"))},[d("span",{class:P(["select-state-description",{loading:t.isLoading}])},w(t.description),3),t.isActive?(s(),b(e(R),{key:0,class:"select-state-check"})):A("",!0)],2),t.hasBorder?(s(),p("hr",lt)):A("",!0)],64))}},Y=$(nt,[["__scopeId","data-v-dd5330e8"]]),st={class:"select-state-content"},rt={__name:"SelectInventoryState",props:{isError:{type:Boolean,default:!1},modelValue:{type:Object,default:null}},emits:["update:modelValue"],setup(t,{emit:r}){const l=r,a=le(),c=function(){a.hasUnloadedOptions&&a.fetchMany({perPage:999,page:1,search:""})},f=function(n,o){l("update:modelValue",n),o()};return(n,o)=>{var i;return s(),b(e(U),{"modal-title":"Статус инвентаря","is-error":t.isError,value:(i=t.modelValue)==null?void 0:i.title,onOpen:c},{label:m(()=>[_(" Статус * ")]),"modal-content":m(({closeModal:h})=>[d("div",st,[e(a).isManyLoading?(s(),p(V,{key:1},D(4,I=>u(Y,{key:I,state:{},"has-border":I!==4,"is-loading":""},null,8,["has-border"])),64)):(s(!0),p(V,{key:0},D(e(a).listData,(I,v)=>{var S;return s(),b(Y,{key:I.id,state:I,description:e(Q)[I.stateConst]??e(Q).default,"has-border":v!==e(a).listData.length-1,"is-active":I.id===((S=t.modelValue)==null?void 0:S.id),onClick:y=>f(I,h)},null,8,["state","description","has-border","is-active","onClick"])}),128))])]),"error-text":m(()=>[T(n.$slots,"error-text",{},void 0,!0)]),_:3},8,["is-error","value"])}}},it=$(rt,[["__scopeId","data-v-3032f66a"]]),ct=t=>(N("data-v-b04c8928"),t=t(),x(),t),dt={class:"image-select-wrapper"},ut={class:"image-selected-img-wrapper"},mt={class:"image-selected-actions"},pt=ct(()=>d("label",{class:"label"},"Добавить изображение",-1)),vt={__name:"BaseImageSelect",props:{modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(t,{emit:r}){const c=H(t,"modelValue",r),f=O(null);let n=0;const o=[{title:"Фото или другой медиафайл",id:4},{title:"Аватар, обложка",id:70}],i=function(){f.value.click()},h=function(){return c.value.some(y=>y.dictId===70)},I=async function(y){const k=new FormData;k.append("file",y.target.files[0]);const g=X({id:++n,isLoading:!0,src:null,resourceId:null,dictId:null,orderId:0});g.dictId=h()?4:70,z.isArray(c.value)?c.value.push(g):c.value=[g];const L=await Le(k);g.id=L.id,g.resourceId=L.resourceId,g.src=L.src,g.isLoading=!1},v=async function(y){if(Number(y.dictId)===70){const k=c.value.find(g=>g.dictId===70&&g.id!==y.id);k.dictId=4}},S=function(y){c.value=c.value.filter(k=>k.id!==y.id)};return(y,k)=>(s(),p("div",dt,[(s(!0),p(V,null,D(e(c),g=>(s(),p("div",{class:P(["image-selected",{loading:g.isLoading}]),key:g.id},[d("div",ut,[d("div",{style:W({backgroundImage:"url(https://media.rentinhand.ru/"+g.src+")"}),class:"image-selected-img"},null,4)]),u(e(kt),{class:"image-selected-type",options:o,modelValue:g.dictId,"onUpdate:modelValue":L=>g.dictId=L,onSelect:L=>v(g),disabled:g.isLoading},null,8,["modelValue","onUpdate:modelValue","onSelect","disabled"]),d("div",mt,[u(e(be),{class:"image-selected-delete",onClick:L=>S(g)},null,8,["onClick"])])],2))),128)),d("div",{class:"image-select",onClick:i},[u(e(we),{class:"icon"}),pt]),d("input",{type:"file",ref_key:"fileDialog",ref:f,accept:"image/*",onChange:I},null,544)]))}},ft=$(vt,[["__scopeId","data-v-b04c8928"]]),yt={class:"base-select-wrapper"},gt=["value","disabled"],ht=["value"],It={__name:"BaseSelect",props:{options:{type:Array,default:()=>[]},label:{type:String,default:"title"},modelValue:{type:null,default:null},reduce:{type:Function,default:Number},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(t,{emit:r}){const l=t,a=r,c=H(l,"modelValue",a),f=n=>{const o=l.reduce(n.target.value);a("update:modelValue",o),a("select",o)};return(n,o)=>(s(),p("div",yt,[d("select",{value:e(c),disabled:t.disabled,class:"base-select",onChange:f},[(s(!0),p(V,null,D(t.options,(i,h)=>(s(),p("option",{key:i.id??i.key??h,value:i.id??i.value},w((i==null?void 0:i[t.label])??i),9,ht))),128))],40,gt),u(e(ne),{class:"select-icon"})]))}},kt=$(It,[["__scopeId","data-v-3665e6c6"]]),_t={class:"wrapper"},Vt=["placeholder"],bt={__name:"BaseTextarea",props:{placeholder:{type:String,default:""},modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(t,{emit:r}){const c=H(t,"modelValue",r);return(f,n)=>(s(),p("div",_t,[se(d("textarea",{class:"input",placeholder:t.placeholder,"onUpdate:modelValue":n[0]||(n[0]=o=>ie(c)?c.value=o:null)},null,8,Vt),[[re,e(c)]])]))}},$t=$(bt,[["__scopeId","data-v-ee21efb9"]]),St={title:"",article:"",inventoryNumber:"",description:"",state:null,category:null,price:null,point:null,media:[]},Dt=ce("inventoryForm",()=>{const t=de(),r=ue();let l=X(z.clone(St));const a=O("pending"),c=O(null),f=O(!1),o=ke({formData:{title:{required:q},state:{required:q},price:{required:q}}},{formData:l}),i=C(()=>!o.value.formData.title.$error),h=C(()=>!o.value.formData.price.$error),I=C(()=>!o.value.formData.state.$error),v=C(()=>o.value.formData.title.$errors),S=C(()=>o.value.formData.price.$errors),y=C(()=>o.value.formData.state.$errors),k=function(){l.title="",l.article="",l.inventoryNumber="",l.description="",l.state=null,l.category=null,l.price=null,l.point=null,l.media=[],a.value="pending",c.value=null,o.value.$reset()};return{save:async function(){if(!await o.value.$validate()){f.value=!0;return}a.value="loading",c.value?await t.editOne(c.value,{id:c.value,...l}):await t.addOne(l),a.value="success",setTimeout(()=>{a.value="pending",k(),r.push({name:"Inventories"})},1500)},handleTitleInput:function(){o.value.formData.title.$touch()},formData:l,state:a,isNotificationShown:f,v$:o,isTitleValid:i,isPriceValid:h,isStateValid:I,titleErrors:v,priceErrors:S,stateErrors:y,fillFormData:async function(F){a.value="loading";const B=await t.getOne(F);l.title=B.title,l.article=B.article,l.inventoryNumber=B.inventoryNumber,l.description=B.description,l.state=B.state,l.category=B.category,l.price=B.price,l.point=B.point,l.media=B.media,c.value=F,a.value="pending"},$reset:k}}),Bt={class:"wrapper"},Ct={__name:"InventoryAddPage",props:{id:{type:[String,Number],default:null}},setup(t){const r=t,l=me(),a=Dt(),c=pe();return ve(()=>{c.query.noReset||(a.$reset(),r.id&&a.fillFormData(r.id))}),(f,n)=>(s(),p(V,null,[d("div",Bt,[u(e(E),{"is-error":!e(a).isTitleValid},{label:m(()=>[_(" Название инвентаря * ")]),content:m(()=>[u(e(j),{placeholder:"Введите название","is-error":!e(a).isTitleValid,modelValue:e(a).formData.title,"onUpdate:modelValue":n[0]||(n[0]=o=>e(a).formData.title=o),onInput:e(a).handleTitleInput},null,8,["is-error","modelValue","onInput"])]),"error-text":m(()=>{var o,i;return[_(w(e(l).validationMessages[(i=(o=e(a).titleErrors)==null?void 0:o.at(0))==null?void 0:i.$validator]),1)]}),_:1},8,["is-error"]),u(e(E),null,{label:m(()=>[_(" Артикул ")]),content:m(()=>[u(e(j),{placeholder:"Введите артикул",modelValue:e(a).formData.article,"onUpdate:modelValue":n[1]||(n[1]=o=>e(a).formData.article=o)},null,8,["modelValue"])]),_:1}),u(e(E),null,{label:m(()=>[_(" Инвентарный номер ")]),content:m(()=>[u(e(j),{placeholder:"Введите номер",modelValue:e(a).formData.inventoryNumber,"onUpdate:modelValue":n[2]||(n[2]=o=>e(a).formData.inventoryNumber=o)},null,8,["modelValue"])]),_:1}),u(e(E),null,{label:m(()=>[_(" Описание ")]),content:m(()=>[u(e($t),{placeholder:"Введите описание",modelValue:e(a).formData.description,"onUpdate:modelValue":n[3]||(n[3]=o=>e(a).formData.description=o)},null,8,["modelValue"])]),_:1}),u(e(it),{modelValue:e(a).formData.state,"onUpdate:modelValue":n[4]||(n[4]=o=>e(a).formData.state=o),"is-error":!e(a).isStateValid},{"error-text":m(()=>{var o,i;return[_(w(e(l).validationMessages[(i=(o=e(a).stateErrors)==null?void 0:o.at(0))==null?void 0:i.$validator]),1)]}),_:1},8,["modelValue","is-error"]),u(e(Re),{modelValue:e(a).formData.category,"onUpdate:modelValue":n[5]||(n[5]=o=>e(a).formData.category=o)},null,8,["modelValue"]),u(e(Je),{modelValue:e(a).formData.price,"onUpdate:modelValue":n[6]||(n[6]=o=>e(a).formData.price=o),"is-error":!e(a).isPriceValid},{"error-text":m(()=>{var o,i;return[_(w(e(l).validationMessages[(i=(o=e(a).priceErrors)==null?void 0:o.at(0))==null?void 0:i.$validator]),1)]}),_:1},8,["modelValue","is-error"]),u(e(ot),{modelValue:e(a).formData.point,"onUpdate:modelValue":n[7]||(n[7]=o=>e(a).formData.point=o)},null,8,["modelValue"]),u(e(ft),{modelValue:e(a).formData.media,"onUpdate:modelValue":n[8]||(n[8]=o=>e(a).formData.media=o)},null,8,["modelValue"]),u(e(Ie),{onClick:e(a).save},{default:m(()=>[_("Сохранить")]),_:1},8,["onClick"])]),u(e(_e),{state:e(a).state},null,8,["state"]),u(e(Ve),{modelValue:e(a).isNotificationShown,"onUpdate:modelValue":n[9]||(n[9]=o=>e(a).isNotificationShown=o),type:"error"},null,8,["modelValue"])],64))}},Ut=$(Ct,[["__scopeId","data-v-d6d6819e"]]);export{Ut as default};
